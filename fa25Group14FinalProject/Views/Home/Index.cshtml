@using fa25Group14FinalProject.Models
@using System.Linq

@{
    ViewData["Title"] = "Home";

    bool isCustomer = User.IsInRole("Customer");
    bool isEmployee = User.IsInRole("Employee");
    bool isAdmin = User.IsInRole("Admin");

    var coupons = ViewBag.ActiveCoupons as List<Coupon>;
}

<div class="text-center mt-5">
    <h1 class="display-4">Welcome to Our Book Store, @ViewBag.CustomerName!</h1>

    @if (!User.Identity.IsAuthenticated)
    {
        <p class="lead mt-3">
            Browse our catalog of books. Create an account to place orders and leave reviews.
        </p>
    }
    else if (isCustomer)
    {
        <p class="lead mt-3">
            Browse books, manage your cart, and review your past orders.
        </p>
    }
    else if (isEmployee || isAdmin)
    {
        <p class="lead mt-3">
            Use the quick links below to get to your daily tasks.
        </p>
    }

    <div class="mt-4">
        <a asp-controller="Books"
           asp-action="Search"
           class="btn btn-success btn-lg m-2">
            Browse Books
        </a>

        @if (isCustomer)
        {
            <a asp-controller="Orders"
               asp-action="Index"
               class="btn btn-info btn-lg m-2">
                View My Orders
            </a>
        }

        @if (isEmployee || isAdmin)
        {
            <a asp-controller="Reviews"
               asp-action="Pending"
               class="btn btn-warning btn-lg m-2">
                Review Queue
            </a>
        }
    </div>

    @* 🔹 Coupon advertising section – CUSTOMER SIDE ONLY *@
    @if (isCustomer && coupons != null && coupons.Any())
    {
        <div class="mt-5">
            <div class="alert alert-info text-left d-inline-block">
                <h4 class="mb-2">💸 Current Coupon Codes</h4>
                <p class="mb-1">Use these codes at checkout to save on your next order:</p>
                <ul class="mb-0">
                    @foreach (var c in coupons)
                    {
                        <li>
                            <strong>@c.CouponCode</strong>
                            @if (c.CouponType == CouponType.PercentOff && c.DiscountPercent.HasValue)
                            {
                                @: – @c.DiscountPercent% off your order
                            }
                            else if (c.CouponType == CouponType.FreeShipping)
                            {
                                if (c.FreeThreshold > 0)
                                {
                                    @: – Free shipping on orders over @String.Format("{0:C}", c.FreeThreshold)

                                }
                                else
                                {
                                    @: – Free shipping on your order
                                }
                            }
                        </li>
                    }
                </ul>
            </div>
        </div>
    }
</div>
