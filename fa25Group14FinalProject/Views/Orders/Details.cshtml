@using fa25Group14FinalProject.Models
@model fa25Group14FinalProject.Models.Order

@{
    ViewData["Title"] = "Order Details";
}

<h1>Order Details for Order #@Model.OrderID</h1>

<div class="row">
    <div class="col-md-6">
        <h4>Order Information</h4>
        <hr />
        <dl class="row">
            <dt class="col-sm-4">
                @Html.DisplayNameFor(model => model.OrderID)
            </dt>
            <dd class="col-sm-8">
                @Html.DisplayFor(model => model.OrderID)
            </dd>

            <dt class="col-sm-4">
                @Html.DisplayNameFor(model => model.OrderDate)
            </dt>
            <dd class="col-sm-8">
                @Html.DisplayFor(model => model.OrderDate)
            </dd>

            <dt class="col-sm-4">
                Customer Name
            </dt>
            <dd class="col-sm-8">
                @Model.Customer.FirstName @Model.Customer.LastName
            </dd>

            <dt class="col-sm-4">
                Card Used
            </dt>
            <dd class="col-sm-8">
                @if (Model.Card != null)
                {
                    <span>
                        @Model.Card.CardType ending in **************@Model.Card.LastFour
                    </span>
                }
                else
                {
                    <span>No card information available.</span>
                }
            </dd>
        </dl>
    </div>

    <div class="col-md-6">
        <h4>Order Summary</h4>
        <hr />
        <dl class="row">
            <dt class="col-sm-4 text-right">
                Subtotal:
            </dt>
            <dd class="col-sm-8">
                @Model.Subtotal.ToString("C")
            </dd>

            @if (Model.DiscountAmount.HasValue && Model.DiscountAmount.Value > 0)
            {
                <dt class="col-sm-4 text-right text-success">
                    Discount:
                </dt>
                <dd class="col-sm-8 text-success">
                    -@(Model.DiscountAmount.Value.ToString("C"))
                </dd>
            }

            <dt class="col-sm-4 text-right">
                Shipping Fee:
            </dt>
            <dd class="col-sm-8">
                @Model.ShippingFee.ToString("C")
            </dd>

            @if (Model.Coupon != null)
            {
                <dt class="col-sm-4 text-right">
                    Coupon Applied:
                </dt>
                <dd class="col-sm-8 text-success font-weight-bold">
                    @Model.Coupon.CouponCode
                </dd>
            }

            <dt class="col-sm-4 text-right font-weight-bold">
                Order Total:
            </dt>
            <dd class="col-sm-8 font-weight-bold">
                @Model.OrderTotal.ToString("C")
            </dd>
        </dl>
    </div>
</div>

<br />

<h4>Order Contents:</h4>

@if (Model.OrderDetails == null || Model.OrderDetails.Count == 0)
{
    <p>This order contains no items yet.</p>
}
else
{
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Book</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Extended Price</th>
                <th></th> @* Actions column for Write Review *@
            </tr>
        </thead>
        <tbody>
            @foreach (var od in Model.OrderDetails)
            {
                <tr>
                    <td>@od.Book.Title</td>
                    <td>@od.Price.ToString("C")</td>
                    <td>@od.Quantity</td>
                    <td>@od.ExtendedPrice.ToString("C")</td>
                    <td>
                        @* Customers can write a review for this book from the Order Details page *@
                        @if (User.IsInRole("Customer"))
                        {
                            <a asp-controller="Reviews"
                               asp-action="Create"
                               asp-route-bookID="@od.BookID"
                               class="btn btn-sm btn-outline-primary">
                                Write Review
                            </a>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

@if (ViewBag.Recommendations != null)
{
    <hr />
    <h4>Recommended for You:</h4>
    @foreach (var book in ViewBag.Recommendations)
    {
        <p>
            <strong>@book.Title</strong> by @book.Authors -
            <a asp-controller="Books" asp-action="Details" asp-route-id="@book.BookID">View Details</a>
        </p>
    }
}

<div>
    <a asp-action="Index">Back to Orders List</a>
</div>
