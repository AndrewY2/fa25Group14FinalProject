@model IEnumerable<dynamic>
@using System.Linq

@{
    ViewData["Title"] = "Report E - Current Inventory";

    // Check if the ViewBag value exists and is a decimal (it should be set by the controller)
    decimal totalInventoryValue = ViewBag.TotalInventoryValue ?? 0m;
}

<div class="row mt-3">
    <div class="col-md-12">
        <a asp-controller="Reports" asp-action="Index" class="btn btn-secondary mb-3">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
    </div>
</div>

<h2 class="mb-3">Current Inventory Report</h2>

<p>
    This report shows the current stock quantity and weighted average cost for each book title.
    Use the search bar on the Dashboard to filter by Title or Genre.
</p>

<p><strong>Record count:</strong> @ViewBag.RecordCount</p>

@if (ViewBag.RecordCount > 0)
{
    <table class="table table-striped table-sm">
        <thead>
            <tr>
                <th>Book Title</th>
                <th>Qty in Stock</th>
                <th>Weighted Average Cost</th>
                <th>Value of Inventory for Title</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var row in Model)
            {
                int quantity = (int)row.InventoryQuantity;
                decimal avgCost = (decimal)row.AverageCost;
                decimal titleValue = quantity * avgCost;

                <tr>
                    <td>@row.Title</td>
                    <td>@quantity</td>
                    <td>@avgCost.ToString("C")</td>
                    <td>@titleValue.ToString("C")</td>
                </tr>
            }
        </tbody>
        <tfoot>
            <tr>
                <th colspan="3" class="text-right">Total Value of Current Inventory:</th>
                <th>@totalInventoryValue.ToString("C")</th>
            </tr>
        </tfoot>
    </table>
}
else
{
    <div class="alert alert-warning" role="alert">
        <strong>No records found.</strong> The current filters did not match any inventory records. Please adjust your criteria and try again.
    </div>
}

